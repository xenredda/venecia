<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pasaporte de Cesarinlandia</title>
  <style>
    :root {
      /* Paleta orientada a un look scrapbook */
      --primary: #36454F;
      /* Gris pizarra oscuro para textos y detalles */
      --paper: #F8F1E5;
      /* Color papel, cálido y vintage */
      --accent: #D4A373;
      /* Acabado en tono terracota para acentos */
      --highlight: #F0E1B4;
      /* Suave tono pastel para destacar fondos */
      --shadow: rgba(0, 0, 0, 0.25);
      --blue: #2C70B2;
      /* Azul para detalles de sellos */
      --red: #CC4D3B;
      /* Rojo para saltos o errores */
    }

    body {
      margin: 0;
      padding: 20px;
      font-family: 'Courier New', Courier, monospace;
      background: linear-gradient(135deg, #a87c64, #634c4c);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .pasaporte {
      background: var(--paper);
      border-radius: 12px;
      padding: 2rem;
      width: 90%;
      max-width: 650px;
      box-shadow: 0 10px 20px var(--shadow);
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border: 5px double var(--accent);
      /* Efectos de textura y collage */
      background-image:
        linear-gradient(120deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0) 70%),
        url('https://www.transparenttextures.com/patterns/old-mathematics.png');
      background-blend-mode: overlay, multiply;
    }

    /* Bordes desgastados en la parte superior e inferior */
    .pasaporte::before {
      content: '';
      position: absolute;
      top: -10px;
      left: 0;
      width: 100%;
      height: 30px;
      background: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/torn-paper.png') no-repeat top center;
      background-size: contain;
    }

    .pasaporte::after {
      content: '';
      position: absolute;
      bottom: -10px;
      right: 0;
      width: 100%;
      height: 30px;
      background: url('https://s3-us-west-2.amazonaws.com/s.cdpn.io/195612/torn-paper.png') no-repeat bottom right;
      background-size: contain;
      transform: scaleX(-1);
    }

    /* Portada */
    .portada {
      text-align: center;
      animation: fadeIn 1s ease;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .portada h1 {
      font-size: 2.8rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
      text-shadow: 2px 2px 4px var(--shadow);
      animation: popIn 1s ease-out;
    }

    .portada .escudo {
      font-size: 4.5rem;
      margin: 1.2rem 0;
      animation: pulse 2s infinite;
      filter: drop-shadow(0 2px 4px var(--shadow));
    }

    .lema {
      font-style: italic;
      font-size: 1.2rem;
      margin: 1rem 0;
      color: var(--blue);
      background: var(--highlight);
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 5px var(--shadow);
      max-width: 85%;
      line-height: 1.5;
    }

    /* Checkpoints */
    .checkpoint {
      margin-top: 1.2rem;
      padding: 1.8rem;
      animation: fadeIn 0.6s ease-out;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #FFF;
      border-radius: 10px;
      box-shadow: inset 0 2px 8px var(--shadow);
      justify-content: center;
    }

    .checkpoint h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--red);
      padding-left: 12px;
      border-left: 4px solid var(--accent);
      animation: slideIn 0.5s ease-out;
    }

    input[type="file"] {
      margin-top: 1rem;
      border: 2px dashed var(--primary);
      padding: 10px;
      border-radius: 8px;
      background: var(--highlight);
      cursor: pointer;
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }

    input[type="file"]:hover {
      background: var(--paper);
      box-shadow: 0 2px 6px var(--shadow);
    }

    .checkpoint img {
      max-width: 100%;
      margin: 1rem 0;
      border: 3px solid var(--primary);
      border-radius: 10px;
      object-fit: contain;
      max-height: 240px;
      box-shadow: 0 4px 10px var(--shadow);
    }

    .buttons {
      margin-top: 1.5rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    button {
      background: var(--primary);
      color: #FFF;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      min-width: 120px;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 3px 8px var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    button:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 5px 12px var(--shadow);
      background: var(--accent);
    }

    button:disabled {
      background: #ccc;
      color: #777;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* Animaciones Personalizadas */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes popIn {
      0% {
        transform: scale(0.8);
        opacity: 0;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(-20px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes bounceSeal {

      0%,
      100% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }

    /* Mensaje final / agradecimiento */
    .agradecimiento {
      font-size: 1.2rem;
      margin: 1.5rem 0;
      line-height: 1.6;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background: var(--highlight);
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 3px 8px var(--shadow);
      text-align: center;
    }

    /* Galería de recuerdos: Layout en fila con scroll horizontal */
    .galeria {
      display: flex;
      overflow-x: auto;
      gap: 1rem;
      scroll-snap-type: x mandatory;
      padding: 1rem;
    }

    .galeria-item {
      flex: 0 0 auto;
      scroll-snap-align: start;
      border: 2px solid var(--accent);
      border-radius: 10px;
      padding: 8px;
      background: #FFF;
      color: var(--primary);
      text-align: center;
      font-size: 0.9rem;
      transition: transform 0.3s ease;
      box-shadow: 0 3px 6px var(--shadow);
      animation: fadeIn 0.6s ease forwards;
    }

    .galeria-item:hover {
      transform: translateY(-3px);
    }

    .galeria-item img {
      max-width: 100%;
      border-radius: 6px;
      margin-bottom: 6px;
      object-fit: cover;
      max-height: 600px;
      aspect-ratio: 1;
    }

    /* Sello de verificación (formato cuadrado) */
    .sello-container {
      margin: 1.5rem 0;
      height: 70px;
      width: 120px;
      position: relative;
      user-select: none;
    }

    .sello {
      width: 100%;
      height: 100%;
      border-radius: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      text-align: center !important;
      font-weight: 900;
      font-size: 1.3rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      position: absolute;
      top: 0;
      left: 0;
      background-color: #FFF;
      border: 3px solid;
      background-image: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.5) 100%);
      animation: bounceSeal 2s infinite ease-in-out;
    }

    .sello.sellado {
      border-color: var(--blue);
      color: var(--blue);
      box-shadow: 0 0 15px var(--blue);
    }

    .sello.saltado {
      border-color: var(--red);
      color: var(--red);
      box-shadow: 0 0 15px var(--red);
    }

    /* Modal Lightbox para ver imagen a tamaño completo y descargarla */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 1000;
    }

    .modal.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal-content {
      position: relative;
      max-width: 90%;
      max-height: 90%;
    }

    .modal-content img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 8px;
    }

    .modal-download {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: var(--accent);
      color: #FFF;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      text-decoration: none;
    }

    @media (max-width: 480px) {
      .pasaporte {
        padding: 1.5rem;
      }

      .portada h1 {
        font-size: 2.2rem;
      }

      .checkpoint h2 {
        font-size: 1.3rem;
      }

      button {
        padding: 0.6rem 1rem;
        min-width: 100px;
      }
    }
  </style>
</head>

<body>
  <div class="pasaporte" id="contenido"></div>

  <script>
    const checkpoints = [
      "Esperarla a que llegue a la estación de autobuses de Pachuca",
      "Fotito juntos abrazaos",
      "Foto del regalo",
      "Tomar la estación del Tuzobús 'Central de Autobuses' en la línea T01",
      "Descender en la estación del Tuzobús 'Presidente Alemán'",
      "Transbordar la línea T05 o T04",
      "Descender en la estación del Tuzobús 'Centro Histórico'",
      "Fotito con el reloj",
      "Pedir a alguien que nos tome una foto a los dos",
      "Fotito con las letras",
      "Ir por un helado al McDonald's o KFC (no sé qué esté abierto)",
      "Caminar por las calles de Guerrero",
      "Fotito de los semáforos pachuqueños",
      "Foto del teatro grandote ese Bartolomé",
      "Foto del Benito Juárez de la Plaza Juárez",
      "Foto con el Palacio de Gobierno",
      "Foto en el parquecito fancy",
      "Foto en la calle Xicoténcatl",
      "Foto de camino al Cuartel del Arte",
      "Foto 1 de Cuartel del Arte",
      "Foto 2 del Cuartel del Arte",
      "Foto 3 del Cuartel del Arte",
      "Foto 1 en el Museo de la Fotografía",
      "Foto 2 en el Museo de la Fotografía",
      "Foto 3 en el Museo de la Fotografía",
      "Fotito de las palmeras de Revolución",
      "COMER UN PASTE KIKO EN PLAZA JUÁREZ",
      "Tomar la estación Plaza Juárez del Tuzobús y tomar la línea T1",
      "Fotito del autobús o vistas del camino 1",
      "Fotito del autobús o vistas del camino 2",
      "Si llegamos a Ohana (descender en Tec de Monterrey)",
      "Si llegamos a Ohana (foto de lo que sea, ojalá y se haga el plan) :(",
      "Foto en la estación Central de Autobuses",
      "Foto de despedida",
      "Foto del boleto",
      "Foto del camino a casa",
      "Foto cuando haya llegado a la estación a Tlax."
    ];

    let current = parseInt(localStorage.getItem('checkpoint')) || -1;

    function formatDateTime(date) {
      return date.toLocaleString('es-MX', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
    }

    function render() {
      const container = document.getElementById('contenido');
      container.innerHTML = '';

      if (current === -1) {
        // Portada
        const portada = document.createElement('div');
        portada.className = 'portada';
        portada.innerHTML = `
          <h1>República del Amor - Cesarinlandia</h1>
          <div class="escudo">⭐</div>
          <p class="lema">“En Cesarinlandia todos son felices y amados y a veces un poco safados jasdjajsd”</p>
          <button onclick="startJourney()">Empezar recorrido</button>
        `;
        container.appendChild(portada);
        return;
      }

      if (current >= checkpoints.length) {
        // Pantalla final y galería
        container.innerHTML = `
          <h2>🎉 ¡Pasaporte completo! 🎉</h2>
          <p class="agradecimiento">Gracias por compartir este viaje a través de Cesarinlandia. Cada lugar, cada risa, cada foto es un sello más en este pasaporte del amor. Espero que lo hayas disfrutado tanto como yo prepararlo para ti.</p>
          <div class="buttons" style="justify-content:center; margin-top: 1rem;">
            <button onclick="verGaleria()">Ver galería de recuerdos 📸</button>
            <button onclick="resetJourney()">Reiniciar pasaporte 🔁</button>
          </div>
        `;
        return;
      }

      // Checkpoint actual
      const cp = document.createElement('div');
      cp.className = 'checkpoint';

      // Obtener foto guardada y fecha
      let fotoGuardada = localStorage.getItem(`foto${current}`);
      let fechaFoto = localStorage.getItem(`fechaFoto${current}`);

      // Check si sellado o saltado
      const estaSellado = (fotoGuardada && fotoGuardada !== 'skip');
      const estaSaltado = (fotoGuardada === 'skip');

      // Contenido previo foto o mensaje "no se pudo"
      let previewContent = '';
      if (estaSellado) {
        previewContent = `
          <img src="${fotoGuardada}" alt="Foto checkpoint ${current + 1}" />
          <p style="font-size:0.85rem; margin-top:0.2rem; color:#2e8b57;">Sellado el: ${fechaFoto ? fechaFoto : 'Desconocida'}</p>
        `;
      }

      // Sello visual
      let selloHtml = '';
      if (estaSellado) {
        selloHtml = `<div class="sello sello-container sellado">Sello ✔</div>`;
      } else if (estaSaltado) {
        selloHtml = `<div class="sello sello-container saltado">Saltado ✘</div>`;
      } else {
        selloHtml = `<div class="sello sello-container" style="border-color:#ccc; color:#ccc; background:#f0f0f0; box-shadow:none; animation:none;">Sin sellar</div>`;
      }

      cp.innerHTML = `
        <h2>Checkpoint ${current + 1}: ${checkpoints[current]}</h2>
        <input type="file" accept="image/*" onchange="guardarFoto(event)" />
        ${previewContent}
        <div class="sello-container">${selloHtml}</div>
        <div class="buttons">
          <button onclick="anteriorCheckpoint()" ${current === 0 ? 'disabled style="opacity:0.5;cursor:default;"' : ''}>Atrás</button>
          <button onclick="saltarCheckpoint()" ${estaSellado || estaSaltado ? 'disabled style="opacity:0.5;cursor:default;"' : ''}>Saltar</button>
          <button onclick="sellarCheckpoint()" ${(!estaSellado && !estaSaltado) ? 'disabled style="opacity:0.5;cursor:default;"' : ''}>Sellar</button>
        </div>
      `;

      container.appendChild(cp);
    }

    function guardarFoto(event) {
      const archivo = event.target.files[0];
      if (!archivo) return;

      const lector = new FileReader();
      lector.onload = function (e) {
        localStorage.setItem(`foto${current}`, e.target.result);

        // Guardar fecha actual legible
        const ahora = new Date();
        localStorage.setItem(`fechaFoto${current}`, formatDateTime(ahora));

        render();
      };
      lector.readAsDataURL(archivo);
    }

    function sellarCheckpoint() {
      // Solo permite avanzar si está sellado o saltado
      let fotoGuardada = localStorage.getItem(`foto${current}`);
      if (!fotoGuardada) return alert("Por favor, sube una foto o salta el checkpoint antes de sellar.");

      current++;
      localStorage.setItem('checkpoint', current);
      render();
    }

    function anteriorCheckpoint() {
      if (current > 0) {
        current--;
        localStorage.setItem('checkpoint', current);
        render();
      }
    }

    function saltarCheckpoint() {
      // Marcar como saltado
      localStorage.setItem(`foto${current}`, 'skip');
      localStorage.removeItem(`fechaFoto${current}`);
      current++;
      localStorage.setItem('checkpoint', current);
      render();
    }

    function startJourney() {
      current = 0;
      localStorage.setItem('checkpoint', current);
      render();
    }

    function verGaleria() {
      const container = document.getElementById('contenido');
      container.innerHTML = `
        <h2>📸 Galería de Recuerdos</h2>
        <div class="galeria"></div>
        <div class="buttons" style="justify-content:center; margin-top: 1rem;">
          <button onclick="render()">Volver al paso actual</button>
          <button onclick="resetJourney()">Reiniciar pasaporte 🔁</button>
        </div>
      `;
      const galeria = container.querySelector('.galeria');

      checkpoints.forEach((_, i) => {
        const foto = localStorage.getItem(`foto${i}`);
        const fecha = localStorage.getItem(`fechaFoto${i}`);
        if (foto && foto !== 'skip') {
          const item = document.createElement('div');
          item.className = 'galeria-item';
          item.innerHTML = `
            <img src="${foto}" alt="Foto checkpoint ${i + 1}" />
            <p><strong>${i + 1}.</strong> ${checkpoints[i]}</p>
            <p>Sellado el:<br>${fecha ? fecha : 'Desconocida'}</p>
          `;
          galeria.appendChild(item);
        } else if (foto === 'skip') {
          const item = document.createElement('div');
          item.className = 'galeria-item';
          item.innerHTML = `
            <div style="width:100%; height:90px; display:flex; align-items:center; justify-content:center; background:#fbeaea; border-radius: 6px; border: 2px solid var(--rojo-sellado); color: var(--rojo-sellado); font-weight: bold; font-size: 0.9rem;">
              Saltado ✘
            </div>
            <p><strong>${i + 1}.</strong> ${checkpoints[i]}</p>
            <p>Sin sellar</p>
          `;
          galeria.appendChild(item);
        }
      });

      setupModal();
      attachGalleryListeners();
    }

    function resetJourney() {
      localStorage.clear();
      current = -1;
      render();
    }

    render();

    // Función para crear el modal (solo se crea si no existe)
    function setupModal() {
      let modal = document.getElementById('gallery-modal');
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'gallery-modal';
        modal.className = 'modal';
        modal.innerHTML = `
      <div class="modal-content">
        <img src="" alt="Imagen Ampliada">
        <a href="" class="modal-download" download>Descargar</a>
      </div>
    `;
        document.body.appendChild(modal);

        // Cerrar el modal al dar click fuera del contenido
        modal.addEventListener('click', function (e) {
          if (e.target === modal) {
            modal.classList.remove('active');
          }
        });
      }
    }

    // Función para agregar listeners a cada imagen de la galería
    function attachGalleryListeners() {
      // Seleccionamos todas las imágenes que se hayan agregado a la galería
      const images = document.querySelectorAll('.galeria-item img');
      images.forEach(img => {
        img.addEventListener('click', function () {
          const modal = document.getElementById('gallery-modal');
          // Asignamos la misma fuente de la imagen seleccionada al modal
          modal.querySelector('img').src = this.src;
          // El enlace de descarga apunta a la misma imagen
          modal.querySelector('.modal-download').href = this.src;
          // Activamos el modal
          modal.classList.add('active');
        });
      });
    }

  </script>
</body>

</html>
